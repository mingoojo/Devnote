# 2. React Testing Library

### 학습 키워드

* React Testing Library
* given - when - then 패턴
* Mocking
* Test fixture



## React Testing Library

React 컴포넌트를 사용자 입장에 가깝게 테스트할 수 있는 도구.



#### RTL의 기본 형태

```typescript
import React from 'react';
import {render, screen} from '@testing-library/react';
import App from './app';

test('App', () => {
  render(<App />); //App이라는 컴포넌트를 렌더링했을때!
  screen.getByText('123'); //'123'이라는 텍스트가 화면에 뜨는가?!?!?
});
```

## given - when - then 패턴

#### TextField를 예시로 테스트해보자!

```typescript
// TextField.test.tsx

import {render, screen} from '@testing-library/react';
import TextField from './component/TextField';

test('TextField', () => {
  // Given
  const label = 'Name';
  const text = 'Tester';

  const setText = () => {
    //
  };

  // When = TextField에 Props를 아래처럼 입력했을때!!
  render(
    <TextField
      label={label}
      placeholder = 'Search...'
      text ={text}
      setText ={setText}
    />,
  );

  // Then = 이러한 결과가 뜨는가?!?!
  screen.getByLabelText(label);
  screen.getByDisplayValue(text);
});
```

* Given = 주어진 값, 테스트에서만 쓰이는 변수(const로 시작됨)
* when = 상황, 렌더를 돌릴 컴포넌트에 \~한 props들이 들어간다(render로 시작됨)
* then = 결과, 위에 상황일때 이러한 결과가 화면에 떠야한다는 내용!((screen으로 시작됨))

#### BDD스타일로 작성!

```tsx
import React from 'react';
import {render, screen, fireEvent} from '@testing-library/react';
import TextField from './component/TextField';

const context = describe;

describe('TextField', () => {
  const label = 'Name';
  const text = 'Tester';

  const setText = jest.fn();

// 실행시마다 mock을 초기화한다.
  beforeEach(() => {
    setText.mockClear();
    jest.clearAllMocks();
  });

  function renderTextField() {
    render(
      <TextField
        label = {label}
        placeholder = 'input your name'
        text = {text}
        setText = {setText}
      />,
    );
  }

  function inputText(value: string) {
    fireEvent.change(screen.getByLabelText(label), {
      target: {value},
    });
  }

  context('testing', () => {
    it('renders elements', () => {
      // When
      renderTextField();

      // Then
      screen.getByLabelText(label);
      screen.getByPlaceholderText(/name/);
      screen.getByDisplayValue(text);
    });
  });
  context('when uset enters name', () => {
    beforeEach(() => {
      renderTextField();
    });
    it('calls "setText" handler', () => {
      inputText('New Name');
      expect(setText).toBeCalledWith('New Name');
    });
  });
});

```

#### fireEvent



## Mocking

### mocking 이란? <a href="#mocking" id="mocking"></a>

* mocking은 단위 테스트를 작성할 때, 해당 코드가 의존하는 부분을 가짜(mock)로 대체하는 방식. 의존성을 없애고 독립적으로 시행하기 위해 사용한다.

#### jest.fn() 사용법 <a href="#jestfn" id="jestfn"></a>

jest에서 가짜 함수(mock functiton)를 생성할 수 있도록 `jest.fn()` 함수를 사용할 수 있다.

* **입력**

```tsx
const setText = jest.fn();
```

* **호출**

```tsx
setText();
setText(1);
setText("a");
setText([1, 2], { a: "b" });

//결과 값은 모두 undefined이다.
```

결과 값이 전혀 호출되지 않기에 `.mockReturnValue(리턴값)`으로 값을 정해줄 수 있다.

```tsx
const setText = jest.fn();
setText.mockReturnValue("I am a mock!");
const context = describe;

describe(('TextField')=>{
  context('testing in', () => {      
    it('testing1', () => {
      expect(setText()).toBe('I am a mock!');
    });
  }
})
```

## Test fixture
